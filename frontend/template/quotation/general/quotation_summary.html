{% extends "template/base.html" %}

{% block title %}견적서 갑지 - SYNEX+{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', path='/css/page/quotation/general/quotation_summary.css') }}">
    <style>
        /* 우측 사이드 플로팅 메뉴 스타일 */
        .side-action-menu {
            position: fixed;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
            padding: 15px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .side-action-menu .btn {
            width: 100px;
            height: 45px;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-success { background-color: #10b981; color: white; }
        .btn-secondary { background-color: #64748b; color: white; }
        .btn-outline { background-color: white; border: 1px solid #cbd5e1 !important; color: #334155; }
        .btn-outline:hover { background-color: #f8fafc; }

        /* 편집 모드 효과 */
        .edit-mode [contenteditable="true"] {
            background-color: #fffbeb !important;
            outline: 1.5px dashed #f59e0b !important;
        }

        /* 수정 불가 컬럼 */
        .edit-mode .col-machine, .edit-mode .col-name, .edit-mode .col-unit-price {
            background-color: #f1f5f9 !important;
            cursor: not-allowed;
            outline: none !important;
        }

        @media print {
            .side-action-menu, .no-print, .action-footer { display: none !important; }
        }
    </style>
{% endblock %}

{% block content %}
<div class="summary-page-content">
    {# 로딩 인디케이터 #}
    <div id="loading" style="display: block; text-align: center; padding: 100px;">
        <p style="font-size: 18px; color: #1e40af;">데이터를 불러오는 중...</p>
    </div>

    {# 우측 사이드 플로팅 메뉴 - Merge 완료 #}
    <div id="sideActionMenu" class="side-action-menu no-print" style="display: none;">
        <button id="btnToggleEdit" class="btn btn-primary" onclick="toggleEditMode('edit')">수정하기</button>
        <button class="btn btn-success" onclick="exportHeaderToExcel()">Excel 저장</button>
        <button class="btn btn-outline" onclick="exportToPDF()">PDF 저장</button>
        <button class="btn btn-outline" onclick="window.print()">인쇄하기</button>
        <button class="btn btn-secondary" onclick="goBack()">목록으로</button>
    </div>

    <div class="summary-container" id="summaryContainer" style="display: none;">
        <div class="summary-header">
            <h1 class="summary-title">QUOTATION</h1>
            <div class="summary-logo">
                <img src="/assets/images/Normal_Logo.png" alt="Logo" class="jlt-logo-large">
            </div>
        </div>

        <div class="summary-info-section">
            <div class="sender-info">
                <div class="info-row"><span class="info-date" id="quotationDate"></span></div>
                <div class="info-box">
                    <div class="info-row"><span class="company-name editable-text" id="senderCompany" contenteditable="false"></span></div>
                    <div class="info-row">
                        <span class="editable-text" id="picName" contenteditable="false"></span>
                        <span class="editable-text" id="picPosition" contenteditable="false"></span>님 귀하
                    </div>
                    <div class="info-row"><label>아래와 같이 견적합니다</label></div>
                </div>
            </div>

            <div class="receiver-info">
                <table class="info-table">
                    <tr>
                        <td class="label-cell" rowspan="5">공<br><br>급<br><br>자</td>
                        <td class="label-cell">견적 번호</td>
                        <td class="value-cell" colspan="3"><input type="text" id="quotationNumber" class="input-field" value="" readonly></td>
                    </tr>
                    <tr>
                        <td class="label-cell">상호(법인명)</td>
                        <td class="value-cell"><input type="text" id="supplierCompany" class="input-field" value="(주)제이엘티" readonly></td>
                        <td class="label-cell">성 명</td>
                        <td class="value-cell"><input type="text" id="supplierName" class="input-field" value="정현우" readonly></td>
                    </tr>
                    <tr>
                        <td class="label-cell">사업장주소</td>
                        <td class="value-cell" colspan="3"><input type="text" id="businessAddress" class="input-field" value="인천광역시 연수구 벤처로 100번길 12" readonly></td>
                    </tr>
                    <tr>
                        <td class="label-cell">업 태</td>
                        <td class="value-cell"><input type="text" id="businessType" class="input-field" value="제조, 도, 소매" readonly></td>
                        <td class="label-cell">사업자번호</td>
                        <td class="value-cell"><input type="text" id="businessNumber" class="input-field" value="362-81-01342" readonly></td>
                    </tr>
                    <tr>
                        <td class="label-cell">TEL</td>
                        <td class="value-cell"><input type="text" id="contactTel" class="input-field" value="010-9187-9593" readonly></td>
                        <td class="label-cell">mail</td>
                        <td class="value-cell"><input type="text" id="contactEmail" class="input-field" value="hwjeong@jltfa.co.kr" readonly></td>
                    </tr>
                </table>
                <div class="stamp-area"><img src="/assets/images/stamp.png" alt="직인" class="stamp-image"></div>
            </div>
        </div>

        <div class="quotation-title-wrapper">
            <div class="quotation-title-section quotation-title-left">
                <div class="title-label">제목:</div>
                <div class="title-content"><div id="quotationTitle" class="editable-text"></div></div>
            </div>
            <div class="quotation-title-section quotation-title-right">
                <div class="title-label">견적금액:</div>
                <div class="title-content">
                    <div id="quotationAmountText"></div>
                    <div class="total-amount">₩<span id="totalAmountVat"></span> (VAT별도)</div>
                </div>
            </div>
        </div>

        <h2 class="document-title" id="documentTitle"></h2>

        <div class="quotation-table-section">
            <table class="quotation-table">
                <thead>
                    <tr>
                        <th class="col-no">No</th>
                        <th class="col-machine">장비명</th>
                        <th class="col-name">품 명</th>
                        <th class="col-spec">규 격</th>
                        <th class="col-quantity">수량</th>
                        <th class="col-unit">단위</th>
                        <th class="col-price">단 가</th>
                        <th class="col-unit-price">공급가액</th>
                        <th class="col-remarks">비 고</th>
                    </tr>
                </thead>
                <tbody id="quotationTableBody"></tbody>
                <tfoot>
                    <tr class="summary-row">
                        <td colspan="4" class="col-center summary-label">견적 총 금액</td>
                        <td class="col-center" id="totalQtySum">0</td>
                        <td class="col-center">Set</td>
                        <td colspan="3" class="col-right summary-amount" id="summaryAmount">0</td>
                    </tr>
                </tfoot>
            </table>

            <div class="remarks-section">
                <div class="remarks-title">비 고(특이사항)</div>
                <div id="remarksSpecial" class="remarks-content editable-text"></div>
            </div>

            <div class="bottom-section">
                <div class="total-section">
                    <div class="total-row">
                        <span class="total-label">Total</span>
                        <span class="total-value" id="totalAmount">0</span>
                    </div>
                    <div class="total-row nego">
                        <span class="total-label">Best nego Total</span>
                        <span class="total-value nego-value editable-text" id="negoTotal" contenteditable="false">0</span>
                    </div>
                </div>
            </div>

            <div class="remarks-section">
                <div class="remarks-title">비 고</div>
                <div id="remarksGeneral" class="remarks-content editable-text"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="{{ url_for('static', path='/js/page/quotation/general/quotation_summary.js') }}"></script>
{% endblock %}