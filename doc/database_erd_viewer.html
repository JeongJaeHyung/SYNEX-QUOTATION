<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNEX QUOTATION DB 구조</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
    <style>
        body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; padding: 40px; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; color: #1f2937; }
        h2 { border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-top: 40px; color: #374151; }
        h3 { margin-top: 30px; color: #2563eb; }
        .mermaid { margin: 0 auto; max-width: 100%; overflow-x: auto; padding: 20px; background: #f9fafb; border-radius: 8px; }
        .btn-container { text-align: center; margin: 20px 0; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover { background-color: #1d4ed8; }
        ul { margin: 10px 0; padding-left: 20px; }
        li { margin-bottom: 5px; }
        code { background-color: #f3f4f6; padding: 2px 4px; border-radius: 4px; font-family: monospace; color: #d946ef; }
        .desc-box { background-color: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>SYNEX QUOTATION 데이터베이스 구조</h1>
    
    <div class="mermaid" id="mermaidGraph">
        erDiagram
            ACCOUNT {
                string(25) id PK "아이디"
                string(255) pwd "비밀번호"
                string(10) name "이름"
                string(25) department "부서"
                string(25) position "직급"
                string(11) phone_number "전화번호"
                string(255) e_mail UK "이메일"
                timestamp created_at "가입일"
                timestamp updated_at "수정일"
            }

            MAKER {
                string(4) id PK "제조사 코드"
                string(100) name "제조사명"
                timestamp created_at
                timestamp updated_at
            }

            RESOURCES {
                string(6) id PK "부품 코드"
                string(4) maker_id PK, FK "제조사 코드"
                string(50) major "대분류 (Unit)"
                string(50) minor "중분류 (품목)"
                string(100) name "모델명/규격"
                string(10) unit "단위"
                integer solo_price "기준 단가"
                integer display_order "표시 순서"
                timestamp created_at
                timestamp updated_at
            }

            CERTIFICATION {
                integer id PK "고유 번호"
                string(6) resources_id FK "부품 코드"
                string(4) maker_id FK "제조사 코드"
                boolean ul "UL 인증"
                boolean ce "CE 인증"
                boolean kc "KC 인증"
                text etc "기타/비고"
                timestamp created_at
                timestamp updated_at
            }

            MACHINE {
                uuid id PK "견적서 ID"
                string(100) name "견적명 (장비명)"
                string(50) manufacturer "장비사"
                string(50) client "고객사"
                string(25) creator "작성자"
                integer price "총 견적 금액"
                text description "비고"
                timestamp created_at "작성일"
                timestamp updated_at "수정일"
            }

            MACHINE_RESOURCES {
                uuid machine_id PK, FK "견적서 ID"
                string(4) maker_id PK, FK "제조사 코드"
                string(6) resources_id PK, FK "부품 코드"
                integer solo_price "적용 단가 (스냅샷)"
                integer quantity "수량"
                integer order_index "정렬 순서"
                string(50) display_major "적용 대분류"
                string(50) display_minor "적용 중분류"
                string(100) display_model_name "적용 모델명"
                string(100) display_maker_name "적용 제조사명"
                string(10) display_unit "적용 단위"
            }

            MAKER ||--o{ RESOURCES : "납품"
            RESOURCES ||--o| CERTIFICATION : "성적표"
            MACHINE ||--o{ MACHINE_RESOURCES : "구성품"
            RESOURCES ||--o{ MACHINE_RESOURCES : "참조"
    </div>

    <div class="btn-container">
        <button onclick="downloadSVG()">ERD 이미지(SVG) 다운로드</button>
    </div>

    <div class="desc-box">
        <h2>테이블 상세 설명 (역할과 용도)</h2>

        <h3>1. ACCOUNT (사용자 명부)</h3>
        <p>이 시스템을 사용하는 <strong>직원들의 계정 정보</strong>를 관리합니다.</p>
        <ul>
            <li><strong>역할:</strong> 로그인 인증, 견적 작성자 식별.</li>
            <li><strong>주요 데이터:</strong> 아이디, 이름, 부서, 직급, 연락처.</li>
        </ul>

        <h3>2. MAKER (제조사 목록)</h3>
        <p>부품을 생산하는 <strong>브랜드(Maker) 리스트</strong>입니다.</p>
        <ul>
            <li><strong>역할:</strong> 부품 등록 시 제조사를 선택하는 기준 정보.</li>
            <li><strong>예시:</strong> LS Electric, Siemens, 미쓰비시 등.</li>
            <li><strong>특이사항:</strong> <code>T000</code>(기타/공백), <code>LABOR</code>(인건비 전용) 같은 특수 코드도 포함됩니다.</li>
        </ul>

        <h3>3. RESOURCES (부품 마스터 / 상품 카탈로그)</h3>
        <p>견적에 사용할 수 있는 <strong>모든 부품과 자재의 원장</strong>입니다. '마트의 상품 진열대'와 같습니다.</p>
        <ul>
            <li><strong>역할:</strong> 견적 작성 시 검색하고 선택할 수 있는 기준 데이터.</li>
            <li><strong>구조:</strong> 제조사(<code>maker_id</code>)와 부품코드(<code>id</code>)가 합쳐져서 하나의 부품을 식별합니다.</li>
            <li><strong>주요 데이터:</strong> 대분류(Unit), 품목, 모델명, <strong>기준 단가</strong>.</li>
        </ul>

        <h3>4. CERTIFICATION (인증 정보)</h3>
        <p>각 부품(<code>RESOURCES</code>)이 보유한 <strong>인증 내역(성적표)</strong>을 별도로 관리합니다.</p>
        <ul>
            <li><strong>역할:</strong> 부품의 신뢰성 정보(UL, CE, KC 인증 여부) 저장.</li>
            <li><strong>관계:</strong> 부품 하나당 하나의 인증 정보가 1:1로 매칭됩니다.</li>
        </ul>

        <h3>5. MACHINE (견적서 헤더 / 프로젝트)</h3>
        <p>작성된 <strong>하나의 견적서(또는 템플릿)</strong> 자체를 의미합니다. '영수증의 머리말'과 같습니다.</p>
        <ul>
            <li><strong>역할:</strong> 견적의 기본 정보와 총액을 관리하는 껍데기.</li>
            <li><strong>주요 데이터:</strong> 견적명(장비명), 고객사, 작성자, <strong>총 합계 금액</strong>, 작성일.</li>
        </ul>

        <h3>6. MACHINE_RESOURCES (견적서 상세 품목 / BOM)</h3>
        <p>견적서(<code>MACHINE</code>) 안에 <strong>실제로 어떤 부품이 몇 개 들어갔는지</strong> 기록하는 상세 내역입니다. '영수증의 품목 리스트'입니다.</p>
        <ul>
            <li><strong>역할:</strong> 견적 구성 내역 저장 및 <strong>작성 시점의 데이터 보존(스냅샷)</strong>.</li>
            <li><strong>스냅샷 기능:</strong> 마스터(<code>RESOURCES</code>)의 가격이나 이름이 나중에 바뀌더라도, <strong>이미 작성된 견적서는 작성 당시의 가격과 이름을 유지</strong>해야 합니다. 그래서 이 테이블은 마스터를 단순히 가리키기만 하는 게 아니라, <strong>당시의 가격(<code>solo_price</code>)과 이름(<code>display_*</code>)을 따로 복사해서 저장</strong>합니다.</li>
        </ul>
    </div>

    <script>
        function downloadSVG() {
            const svg = document.querySelector('.mermaid svg');
            if (!svg) {
                alert('다이어그램이 아직 렌더링되지 않았습니다. 잠시 후 다시 시도해주세요.');
                return;
            }
            
            const svgData = new XMLSerializer().serializeToString(svg);
            const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'synex_db_erd.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>