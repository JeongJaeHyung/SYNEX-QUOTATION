{% extends "template/base.html" %}
{% from "widget/data_table.html" import data_table %}

{% block title %}ë¶€í’ˆ/ìì¬ ëª©ë¡ - SYNEX+{% endblock %}

{% block content %}
<div class="page-content">
    {# ìƒë‹¨ ì•¡ì…˜ ë°” #}
    <div class="action-bar">
        <div class="action-bar-left">
            <button class="btn btn-primary" onclick="openRegisterPopup()">
                <span>+</span> ë¶€í’ˆ ë“±ë¡
            </button>
            <button class="btn btn-secondary" onclick="deleteSelected()">
                <span>ğŸ—‘</span> ì„ íƒ ì‚­ì œ
            </button>
        </div>
        <div class="action-bar-right">
            <select class="input-dropdown" id="categoryFilter">
                <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                <option value="1">íŒë„¬</option>
                <option value="8">ì¡ì¬ë£Œ ë° ì¼€ì´ë¸”</option>
            </select>
            <input type="text" class="input-search" placeholder="ë¶€í’ˆëª… ê²€ìƒ‰..." id="searchInput">
            <button class="btn btn-primary" onclick="searchParts()">ê²€ìƒ‰</button>
        </div>
    </div>

    {# í…Œì´ë¸” #}
    {{ data_table(
        columns=[
            {"key": "id", "label": "ë¶€í’ˆ ID", "width": "8%", "sortable": true},
            {"key": "maker.name", "label": "ì œì¡°ì‚¬", "width": "12%", "sortable": true},
            {"key": "category.major", "label": "ì¹´í…Œê³ ë¦¬", "width": "12%"},
            {"key": "category.minor", "label": "ì„¸ë¶€ë¶„ë¥˜", "width": "12%"},
            {"key": "name", "label": "ë¶€í’ˆëª…", "width": "20%"},
            {"key": "unit", "label": "ë‹¨ìœ„", "width": "6%", "align": "center"},
            {"key": "solo_price", "label": "ë‹¨ê°€", "width": "10%", "align": "right", "type": "number"},
            {"key": "certification.ul", "label": "UL", "width": "5%", "align": "center", "type": "badge"},
            {"key": "certification.ce", "label": "CE", "width": "5%", "align": "center", "type": "badge"},
            {"key": "certification.kc", "label": "KC", "width": "5%", "align": "center", "type": "badge"}
        ],
        data=parts,
        checkable=true,
        clickable=true,
        on_row_click="goToDetail(id)",
        table_id="partsTable",
        empty_message="ë“±ë¡ëœ ë¶€í’ˆì´ ì—†ìŠµë‹ˆë‹¤"
    ) }}
    
    {# í˜ì´ì§€ë„¤ì´ì…˜ #}
    <div class="pagination">
        <button class="btn btn-secondary" onclick="prevPage()">ì´ì „</button>
        <span class="page-info">1 / 10</span>
        <button class="btn btn-secondary" onclick="nextPage()">ë‹¤ìŒ</button>
    </div>
</div>

<script>
// ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
function goToDetail(id) {
    window.location.href = `/service/parts/${id}`;
}

// ë¶€í’ˆ ë“±ë¡ íŒì—…
function openRegisterPopup() {
    alert('ë¶€í’ˆ ë“±ë¡ íŒì—… (êµ¬í˜„ ì˜ˆì •)');
}

// ì„ íƒ ì‚­ì œ
function deleteSelected() {
    const selected = getSelectedRows('partsTable');
    if (selected.length === 0) {
        alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        return;
    }
    if (confirm(`ì„ íƒí•œ ${selected.length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        console.log('Delete:', selected);
        // TODO: API í˜¸ì¶œ
    }
}

// ê²€ìƒ‰
function searchParts() {
    const query = document.getElementById('searchInput').value;
    const category = document.getElementById('categoryFilter').value;
    
    let url = '/service/parts/list?';
    if (query) url += `search=${query}&`;
    if (category) url += `category=${category}`;
    
    window.location.href = url;
}

// í˜ì´ì§€ë„¤ì´ì…˜
function prevPage() {
    console.log('Previous page');
}

function nextPage() {
    console.log('Next page');
}
</script>

<style>
/* í˜ì´ì§€ë„¤ì´ì…˜ */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--spacing-md);
    margin-top: var(--spacing-xl);
}

.page-info {
    font-size: var(--font-size-sm);
    color: var(--gray-600);
    min-width: 60px;
    text-align: center;
}
</style>
{% endblock %}