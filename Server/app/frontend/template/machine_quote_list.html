{% extends "template/base.html" %}
{% from "widget/data_table.html" import data_table %}

{% block title %}정비 견적서 - SYNEX+{% endblock %}

{% block content %}
<div class="page-content">
    {# 상단 액션 바 #}
    <div class="action-bar">
        <div class="action-bar-left">
            <button class="btn btn-primary" onclick="openCreatePopup()">
                <span>+</span> 견적 생성
            </button>
        </div>
        <div class="action-bar-right">
            <input type="text" class="input-search" placeholder="검색어를 입력해 주세요" id="searchInput">
            <button class="btn btn-primary" onclick="searchMachines()">검색하기</button>
        </div>
    </div>

    {# 테이블 #}
    {{ data_table(
        columns=[
            {
                "key": "name",
                "label": "명칭명",
                "width": "70%",
                "align": "left"
            },
            {
                "key": "updated_at",
                "label": "최종 수정일",
                "width": "30%",
                "align": "center",
                "type": "date"
            }
        ],
        data=machines,
        clickable=true,
        on_row_click="goToDetail(id)",
        table_id="machineTable",
        empty_message="등록된 견적서가 없습니다"
    ) }}
</div>

<script>
// 상세 페이지로 이동
function goToDetail(id) {
    window.location.href = `/service/quotation/maintenance/${id}`;
}

// 견적 생성 팝업
function openCreatePopup() {
    // TODO: 팝업 구현
    alert('견적 생성 팝업 (구현 예정)');
}

// 검색
function searchMachines() {
    const query = document.getElementById('searchInput').value;
    if (query) {
        window.location.href = `/service/quotation/maintenance/list?search=${query}`;
    }
}
</script>

<style>
/* 페이지 컨텐츠 */
.page-content {
    background-color: #fff;
    border-radius: var(--border-radius-md);
    padding: var(--spacing-xl);
}

/* 액션 바 */
.action-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
    gap: var(--spacing-lg);
}

.action-bar-left,
.action-bar-right {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

@media (max-width: 768px) {
    .action-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .action-bar-left,
    .action-bar-right {
        width: 100%;
    }
    
    .input-search {
        flex: 1;
    }
}
</style>
{% endblock %}