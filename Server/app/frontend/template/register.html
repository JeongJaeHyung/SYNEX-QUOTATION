<!--app/frontend/template/register.html-->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 - SYNEX+</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            {# 로고 #}
            <div class="auth-header">
                <h1 class="auth-logo">SYNEX<span>+</span></h1>
                <p class="auth-subtitle">계정을 생성하세요</p>
            </div>

            {# 회원가입 폼 #}
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="id">아이디 <span class="required">*</span></label>
                    <div class="input-with-button">
                        <input 
                            type="text" 
                            id="id" 
                            name="id" 
                            class="form-input" 
                            placeholder="아이디 (최대 25자)"
                            required
                            maxlength="25"
                        >
                        <button type="button" class="btn btn-secondary btn-sm" onclick="checkDuplicate()">중복확인</button>
                    </div>
                    <span id="idMessage" class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="pwd">비밀번호 <span class="required">*</span></label>
                    <input 
                        type="password" 
                        id="pwd" 
                        name="pwd" 
                        class="form-input" 
                        placeholder="비밀번호"
                        required
                        minlength="6"
                    >
                </div>

                <div class="form-group">
                    <label for="pwd_confirm">비밀번호 확인 <span class="required">*</span></label>
                    <input 
                        type="password" 
                        id="pwd_confirm" 
                        name="pwd_confirm" 
                        class="form-input" 
                        placeholder="비밀번호 확인"
                        required
                    >
                    <span id="pwdMessage" class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="name">이름 <span class="required">*</span></label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        class="form-input" 
                        placeholder="이름 (최대 10자)"
                        required
                        maxlength="10"
                    >
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="department">부서 <span class="required">*</span></label>
                        <input 
                            type="text" 
                            id="department" 
                            name="department" 
                            class="form-input" 
                            placeholder="예: 의정부, 의적팀"
                            required
                            maxlength="25"
                        >
                    </div>

                    <div class="form-group">
                        <label for="position">직급 <span class="required">*</span></label>
                        <input 
                            type="text" 
                            id="position" 
                            name="position" 
                            class="form-input" 
                            placeholder="예: 사원"
                            required
                            maxlength="25"
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label for="phone_number">전화번호 <span class="required">*</span></label>
                    <input 
                        type="tel" 
                        id="phone_number" 
                        name="phone_number" 
                        class="form-input" 
                        placeholder="01012345678 (숫자만)"
                        required
                        maxlength="11"
                        pattern="[0-9]{10,11}"
                    >
                </div>

                <div class="form-group">
                    <label for="e_mail">이메일 <span class="required">*</span></label>
                    <input 
                        type="email" 
                        id="e_mail" 
                        name="e_mail" 
                        class="form-input" 
                        placeholder="example@ejb.co.kr"
                        required
                        maxlength="255"
                    >
                </div>

                <button type="submit" class="btn btn-primary btn-block" id="submitBtn" disabled>회원가입</button>
            </form>

            {# 로그인 링크 #}
            <div class="auth-footer">
                <p>이미 계정이 있으신가요? <a href="/login">로그인</a></p>
            </div>
        </div>
    </div>

    <script>
    let idChecked = false;

    // 아이디 중복 확인
    async function checkDuplicate() {
        const id = document.getElementById('id').value;
        const message = document.getElementById('idMessage');
        
        if (!id) {
            message.textContent = '아이디를 입력하세요.';
            message.className = 'form-message error';
            return;
        }
        
        try {
            const response = await fetch('/api/v1/account/check', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: id })
            });
            
            const data = await response.json();
            
            if (data.available) {
                message.textContent = '✓ 사용 가능한 아이디입니다.';
                message.className = 'form-message success';
                idChecked = true;
                updateSubmitButton();
            } else {
                message.textContent = '이미 사용 중인 아이디입니다.';
                message.className = 'form-message error';
                idChecked = false;
                updateSubmitButton();
            }
        } catch (error) {
            console.error('Error:', error);
            message.textContent = '중복 확인 중 오류가 발생했습니다.';
            message.className = 'form-message error';
        }
    }

    // 아이디 입력 변경 시 중복 확인 초기화
    document.getElementById('id').addEventListener('input', function() {
        idChecked = false;
        document.getElementById('idMessage').textContent = '';
        updateSubmitButton();
    });

    // 비밀번호 확인
    document.getElementById('pwd_confirm').addEventListener('input', function() {
        const pwd = document.getElementById('pwd').value;
        const pwdConfirm = this.value;
        const message = document.getElementById('pwdMessage');
        
        if (pwdConfirm && pwd !== pwdConfirm) {
            message.textContent = '비밀번호가 일치하지 않습니다.';
            message.className = 'form-message error';
        } else if (pwdConfirm && pwd === pwdConfirm) {
            message.textContent = '✓ 비밀번호가 일치합니다.';
            message.className = 'form-message success';
        } else {
            message.textContent = '';
        }
        
        updateSubmitButton();
    });

    // 제출 버튼 활성화/비활성화
    function updateSubmitButton() {
        const pwd = document.getElementById('pwd').value;
        const pwdConfirm = document.getElementById('pwd_confirm').value;
        const submitBtn = document.getElementById('submitBtn');
        
        if (idChecked && pwd && pwdConfirm && pwd === pwdConfirm) {
            submitBtn.disabled = false;
        } else {
            submitBtn.disabled = true;
        }
    }

    // 회원가입 제출
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!idChecked) {
            alert('아이디 중복 확인을 해주세요.');
            return;
        }
        
        const formData = {
            id: document.getElementById('id').value,
            pwd: document.getElementById('pwd').value,
            name: document.getElementById('name').value,
            department: document.getElementById('department').value,
            position: document.getElementById('position').value,
            phone_number: document.getElementById('phone_number').value,
            e_mail: document.getElementById('e_mail').value
        };
        
        try {
            const response = await fetch('/api/v1/account/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            if (response.ok) {
                const data = await response.json();
                alert('회원가입이 완료되었습니다!');
                window.location.href = '/login';
            } else {
                const error = await response.json();
                alert('회원가입 실패: ' + (error.detail || '알 수 없는 오류'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('회원가입 중 오류가 발생했습니다.');
        }
    });
    </script>

    <style>
    /* 인증 페이지 레이아웃 */
    .auth-page {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 40px 20px;
    }

    .auth-container {
        width: 100%;
        max-width: 520px;
    }

    .auth-card {
        background: #ffffff;
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    /* 헤더 */
    .auth-header {
        text-align: center;
        margin-bottom: 32px;
    }

    .auth-logo {
        font-size: 36px;
        font-weight: 700;
        color: #1f2937;
        margin: 0 0 8px 0;
    }

    .auth-logo span {
        color: #2563eb;
    }

    .auth-subtitle {
        color: #6b7280;
        font-size: 14px;
        margin: 0;
    }

    /* 폼 */
    .auth-form {
        margin-bottom: 24px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
    }

    .required {
        color: #ef4444;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s;
        box-sizing: border-box;
    }

    .form-input:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .input-with-button {
        display: flex;
        gap: 8px;
    }

    .input-with-button .form-input {
        flex: 1;
    }

    .btn-sm {
        padding: 10px 16px;
        font-size: 13px;
        white-space: nowrap;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .form-message {
        display: block;
        font-size: 12px;
        margin-top: 6px;
    }

    .form-message.error {
        color: #ef4444;
    }

    .form-message.success {
        color: #10b981;
    }

    .btn-block {
        width: 100%;
        padding: 14px;
        font-size: 16px;
        margin-top: 8px;
    }

    .btn-block:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* 푸터 */
    .auth-footer {
        text-align: center;
        padding-top: 24px;
        border-top: 1px solid #e5e7eb;
    }

    .auth-footer p {
        color: #6b7280;
        font-size: 14px;
        margin: 0;
    }

    .auth-footer a {
        color: #2563eb;
        text-decoration: none;
        font-weight: 500;
    }

    .auth-footer a:hover {
        text-decoration: underline;
    }

    @media (max-width: 640px) {
        .auth-card {
            padding: 24px;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
    }
    </style>
</body>
</html>